<div class="calendar-container">
  <h2>Monthly Attendance</h2>

  <!-- Filters -->
  <div class="filters">
    <label>
      Class:
      <select [(ngModel)]="selectedClass" (change)="loadAttendance()">
        <option *ngFor="let cls of classes" [value]="cls.id">{{ cls.name }}</option>
      </select>
    </label>

    <label>
      Student:
      <select [(ngModel)]="selectedStudent" (change)="loadAttendance()">
        <option value="">All Students</option>
        <option *ngFor="let student of filteredStudents()" [value]="student.id">{{ student.name }}</option>
      </select>
    </label>

    <div class="month-nav">
      <button (click)="prevMonth()">⬅️</button>
      <span>{{ monthNames[currentMonth] }} {{ currentYear }}</span>
      <button (click)="nextMonth()">➡️</button>
    </div>
  </div>

  <!-- Calendar -->
  <div class="calendar-grid">
    <div class="day-name" *ngFor="let d of dayNames">{{ d }}</div>
    <div class="day" *ngFor="let day of daysInMonth"
         [class.today]="day.today"
         (click)="openAttendance(day.date)">
      <span>{{ day.date.getDate() }}</span>
      <div class="status" *ngIf="day.status">
        <span [ngClass]="day.status">{{ day.status[0] }}</span>
      </div>
    </div>
  </div>

  <!-- Attendance Dialog -->
  <div *ngIf="selectedDay" class="dialog">
    <h3>Attendance for {{ selectedDay | date:'fullDate' }}</h3>
    <table>
      <tr>
        <th>Student</th>
        <th>Status</th>
      </tr>
      <tr *ngFor="let student of filteredStudents()">
        <td *ngIf="student.id==selectedStudent">{{ student.name }}</td>
        <td *ngIf="student.id==selectedStudent">
          <select [(ngModel)]="selectedStatus">
            <option value="PRESENT">✅ Present</option>
            <option value="ABSENT">❌ Absent</option>
            <option value="LATE">🕐 Late</option>
          </select>
        </td>
      </tr>
    </table>
    <div class="actions">
      <button (click)="saveDayAttendance()">Save</button>
      <button (click)="closeDialog()">Cancel</button>
    </div>
  </div>
</div>
