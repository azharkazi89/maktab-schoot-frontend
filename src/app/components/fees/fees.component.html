<div class="fees-page">
  <div class="page-header">
    <h2>Fees Management</h2>
  </div>

  <!-- Totals -->
  <div class="fees-totals">
    <p><strong>Total Fees Collected:</strong> {{ getTotalFees() | currency }}</p>
    <p><strong>Pending Fees:</strong> {{ getPendingFees() | currency }}</p>
  </div>

  <!-- Filters -->
  <div class="fees-filters">
    <select [(ngModel)]="selectedClass">
      <option value="">All Classes</option>
      <option *ngFor="let cls of classes" [value]="cls">{{cls}}</option>
    </select>

    <select [(ngModel)]="selectedMonth">
      <option value="">All Months</option>
      <option *ngFor="let m of months" [value]="m">{{m}}</option>
    </select>

    <select [(ngModel)]="selectedStatus">
      <option value="">All Status</option>
      <option value="paid">Paid</option>
      <option value="unpaid">Unpaid</option>
      <option value="fi-sabilillah">Fi Sabilillah</option>
    </select>

    <input type="text" placeholder="Search by student name" [(ngModel)]="searchText">
  </div>

  <!-- Bulk actions -->
  <div class="bulk-actions">
    <button class="action-btn paid" (click)="bulkUpdateStatus('paid')">âœ” Mark Selected as Paid</button>
    <button class="action-btn unpaid" (click)="bulkUpdateStatus('unpaid')">âœ– Mark Selected as Unpaid</button>
    <button class="action-btn notify" (click)="notifyParents()">ðŸ“© Notify Parents</button>
  </div>


  <!-- Fees Table -->
  <table class="fees-table">
    <thead>
    <tr>
      <th><input type="checkbox" [(ngModel)]="selectAll" (change)="toggleAllSelection()"></th>
      <th>Student Name</th>
      <th>Class</th>
      <th>Month</th>
      <th>Total Fee</th>
      <th>Total due</th>
      <th>Total Paid</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let fee of filteredFees(); let i = index">
      <td><input type="checkbox" [(ngModel)]="fee.selected"></td>
      <td>{{ fee.studentName }}</td>
      <td>{{ fee.class }}</td>
      <td>{{ fee.month }}</td>
      <td>{{ fee.amount | currency }}</td>
      <td>{{ fee.amount | currency }}</td>
      <td>{{ fee.amount | currency }}</td>
      <td>
          <span [ngClass]="{
            'paid': fee.status==='paid',
            'unpaid': fee.status==='unpaid',
            'fi-sabilillah': fee.status==='fi-sabilillah'
          }">
            {{ fee.status | titlecase }}
          </span>
      </td>
    </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="pagination">
    <button (click)="prevPage()" [disabled]="currentPage===1">Prev</button>
    <span>Page {{currentPage}} / {{totalPages}}</span>
    <button (click)="nextPage()" [disabled]="currentPage===totalPages">Next</button>
  </div>
</div>
